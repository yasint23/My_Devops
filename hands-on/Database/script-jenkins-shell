# Script to jenkins execute shell for taking db_backup of db_server
pipeline {   
    agent any
    stages{
        stage('Database backend via SSH') {
            steps {
                sshagent(credentials: ['db_ubuntu']) {
                  sh 'ssh -o StrictHostKeyChecking=no ubuntu@172.31.88.4 docker exec kypnt-mysql /usr/bin/mysqldump -u kps --password=Ug5YCpXFKNe3gy > ~/mysql_backup/backup.sql'
                }
            }
        }
    }
}

 

        stage("Upload to AWS S3"){
            steps{
                withAWS(region:"${REGION}", credentials:"${AWS_CREDENTIALS}"){
                    s3Upload(file:"${FOLDER}", bucket:"${BUCKET}", path:'')
                }    
            }
        }
    }
}